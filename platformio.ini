; PlatformIO Project Configuration File
; 摩托车手套终端重构项目 (ESP32-S3)
; 遵循架构: C++17, 组件化, Zero-Cost Abstraction

[platformio]
default_envs = esp32-s3-terminal
; 强制重新生成 compile_commands.json，有助于 VSCode 识别
src_dir = src
include_dir = include

; ==============================================================================
; 通用配置 (所有环境共享)
; ==============================================================================
[common]
lib_deps = 
    ; 暂时无外部库

; 关键修正：强力移除 C++11 相关标志
build_unflags = 
    -std=gnu++11
    -std=c++11

; 通用编译标志
build_flags =
    -std=gnu++17            ; 强制使用 C++17
    -DCONFIG_FREERTOS_HZ=1000
    -O2                     ; 默认优化级别
    -fno-rtti               ; 禁用运行时类型识别
    -fno-exceptions         ; 禁用 C++ 异常
    -Wall                   ; 开启常用警告
    -Wextra                 ; 开启额外警告

; ==============================================================================
; 硬件环境: ESP32-S3 终端 (Freenove Board)
; ==============================================================================
[env:esp32-s3-terminal]
platform = espressif32
board = freenove_esp32_s3_wroom
framework = arduino

; --- 串口监视器 ---
monitor_speed = 115200
monitor_filters = esp32_exception_decoder, time, colorize

; --- 分区与存储 ---
board_build.partitions = huge_app.csv
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = qio

; --- 编译标志 ---
build_unflags = ${common.build_unflags}
build_flags = 
    ${common.build_flags}
    -D ESP32
    -D BOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    
    ; 日志系统配置
    -D CORE_DEBUG_LEVEL=0   
    -D ACTIVE_LOG_LEVEL=3   

; --- 上传配置 ---
upload_speed = 921600

; ==============================================================================
; 测试环境: 本地 PC
; ==============================================================================
[env:native]
platform = native
test_framework = unity
build_unflags = -std=gnu++11
build_flags = 
    -std=c++17
    -D UNIT_TEST            
    -D ACTIVE_LOG_LEVEL=3   
    -g